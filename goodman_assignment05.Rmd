---
title: "goodman_assignment05"
output: html_document
---

# First step... generate a matrix, size 250x250, and fill it randomly with values 1-4 to represent C, S, R, and empty spaces in the vector.

create.matrix <- function(variable, nrows=250,ncols=250){
	matrix(sample(variable, nrows*ncols, replace=TRUE), nrow=nrows, ncol=ncols)
}


# Pick random cell, sample surroundings, figure out what the cell will become

simulation <- function(matrix, nSim=5000){
nrow <- sample(1:nrow(matrix), 1)
ncol <- sample(1:ncol(matrix), 1)
index <- c(nrow,ncol)
index.value <- matrix[nrow,ncol]

if(nrow==1 && ncol==1){
a <- matrix[nrow(matrix),ncol]
b <- matrix[nrow(matrix),ncol+1]
c <- matrix[nrow(matrix),ncol(matrix)]
d <- matrix[nrow+1, ncol]
e <- matrix[nrow+1, ncol(matrix)]
f <- matrix[nrow+1, ncol+1]
g <- matrix[nrow, ncol+1]
h <- matrix[nrow, ncol(matrix)]
} else if(nrow==1 && ncol==ncol(matrix)){
a <- matrix[nrow(matrix),ncol]
b <- matrix[nrow(matrix),ncol(matrix)]
c <- matrix[nrow(matrix),ncol-1]
d <- matrix[nrow+1, ncol]
e <- matrix[nrow+1, ncol-1]
f <- matrix[nrow+1, ncol(matrix)]
g <- matrix[nrow, ncol(matrix)]
h <- matrix[nrow, ncol-1]
} else if(nrow==nrow(matrix) && ncol==ncol(matrix)){
a <- matrix[nrow-1,ncol]
b <- matrix[nrow-1,1]
c <- matrix[nrow-1,ncol-1]
d <- matrix[1, ncol]
e <- matrix[1, ncol-1]
f <- matrix[1, 1]
g <- matrix[nrow, 1]
h <- matrix[nrow, ncol-1]
} else if(nrow==nrow(matrix) && ncol==1){
a <- matrix[nrow-1,ncol]
b <- matrix[nrow-1,ncol(matrix)]
c <- matrix[nrow-1,ncol+1]
d <- matrix[1, ncol]
e <- matrix[1, ncol(matrix)]
f <- matrix[1, ncol+1]
g <- matrix[nrow, ncol+1]
h <- matrix[nrow, ncol(matrix)]
} else if(nrow==1){
a <- matrix[nrow(matrix),ncol]
b <- matrix[nrow(matrix),ncol+1]
c <- matrix[nrow(matrix),ncol-1]
d <- matrix[nrow+1, ncol]
e <- matrix[nrow+1, ncol-1]
f <- matrix[nrow+1, ncol+1]
g <- matrix[nrow, ncol+1]
h <- matrix[nrow, ncol-1]
} else if(ncol==1){
a <- matrix[nrow-1,ncol]
b <- matrix[nrow-1,ncol+1]
c <- matrix[nrow-1,ncol(matrix)]
d <- matrix[nrow+1, ncol]
e <- matrix[nrow+1, ncol(matrix)]
f <- matrix[nrow+1, ncol+1]
g <- matrix[nrow, ncol+1]
h <- matrix[nrow, ncol(matrix)]
} else if(ncol==ncol(matrix)){
a <- matrix[nrow-1,ncol]
b <- matrix[nrow-1,1]
c <- matrix[nrow-1,ncol-1]
d <- matrix[nrow+1, ncol]
e <- matrix[nrow+1, ncol-1]
f <- matrix[nrow+1, 1]
g <- matrix[nrow, 1]
h <- matrix[nrow, ncol-1]
} else if(nrow==nrow(matrix)){
a <- matrix[nrow-1,ncol]
b <- matrix[nrow-1,ncol+1]
c <- matrix[nrow-1,ncol-1]
d <- matrix[1, ncol]
e <- matrix[1, ncol-1]
f <- matrix[1, ncol+1]
g <- matrix[nrow, ncol+1]
h <- matrix[nrow, ncol-1] 
} else {
a <- matrix[nrow-1,ncol]
b <- matrix[nrow-1,ncol+1]
c <- matrix[nrow-1,ncol-1]
d <- matrix[nrow+1, ncol]
e <- matrix[nrow+1, ncol-1]
f <- matrix[nrow+1, ncol+1]
g <- matrix[nrow, ncol+1]
h <- matrix[nrow, ncol-1] }
local <- c(a,b,c,d,e,f,g,h) 

if(index.value=="R"){
    present <- sum(local=="S")
    if(present>0){
        index.value <- "S"
        } else {index.value<-"R"}
} else if(index.value=="C"){
    present <- sum(local=="R")
    if(present>0){
        index.value <- "R"
        } else {index.value<-"C"}
} else if(index.value=="S"){
    present <- sum(local=="C")
    present <- present/8
    S <- 1/4 +3/4*present
    C <- 1/3
    if(C<S){
       index.value <- "C"
    } else {index.value<-"S"}
} else {
    index.value <- local[sample(1:8, 1)]
}
matrix[nrow,ncol] <- index.value
rbind(1, sum(matrix=="R"), sum(matrix=="S"), sum(matrix=="C"))
}

m <- replicate(5000, cbind(abundance <- simulation(matrix)), simplify=T)
m[1,1:5000] <- 1:5000
m[2,] <- sapply(m[2,], log)
m[3,] <- sapply(m[3,], log)
m[4,] <- sapply(m[4,], log)